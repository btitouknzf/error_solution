エラー対処票
-------------------------------------------------------
使用環境

状況

エラー内容

原因

解決策

-------------------------------------------------------

001
使用環境
STS+TERASOLUNA+Spring-test(Junit)+H2+mybatis+maven

状況
テスト用にDBをH2で構築

エラー内容
Caused by: java.lang.ClassNotFoundException: org.h2.Driver
	at java.net.URLClassLoader.findClass(Unknown Source)
	at java.lang.ClassLoader.loadClass(Unknown Source)
	at sun.misc.Launcher$AppClassLoader.loadClass(Unknown Source)
	at java.lang.ClassLoader.loadClass(Unknown Source)
	at org.apache.commons.dbcp2.BasicDataSource.createConnectionFactory(BasicDataSource.java:2131)
	... 50 common frames omitted
	
原因
H2のライブラリとのパスが繋がっていない。

解決策
pom.xmlのprofilesにcom.h2databaseを設定する。

	<profiles>
        <profile>
            <id>local</id>
            <activation>
                <activeByDefault>true</activeByDefault>
            </activation>
            <properties>
                <resource.directory>src/main/resources</resource.directory>
                <buildFinalName>${project.artifactId}-${project.version}</buildFinalName>
            </properties>
            <dependencies>
                <dependency>
                    <groupId>com.h2database</groupId>
                    <artifactId>h2</artifactId>
                    <scope>runtime</scope>
                </dependency>
            </dependencies>
        </profile>
        <profile>
            <id>test-server</id>
            <properties>
                <resource.directory>${basedir}/configs/test-server/resources</resource.directory>
                <buildFinalName>${project.artifactId}-${project.version}-test-server</buildFinalName>
            </properties>
        </profile>
        <profile>
            <id>production-server</id>
            <properties>
                <resource.directory>${basedir}/configs/production-server/resources</resource.directory>
                <buildFinalName>${project.artifactId}-${project.version}-production-server</buildFinalName>
            </properties>
        </profile>
    </profiles>

-------------------------------------------------------

002
使用環境
STS+TERASOLUNA+Spring-test(Junit)+H2+mybatis+maven

状況
テスト用にDBをH2で構築
test-context.xmlにてAOPの設定を行った

エラー内容
Caused by: org.springframework.beans.factory.NoSuchBeanDefinitionException: No bean named 'exceptionLogger' available
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBeanDefinition(DefaultListableBeanFactory.java:685)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getMergedLocalBeanDefinition(AbstractBeanFactory.java:1199)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:284)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:197)
	at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:351)
	... 59 common frames omitted
	

原因
exceptionLoggerクラスが見つからない


解決策
xmlにexceptionLoggerクラスのbean定義を追加する。

<bean id="exceptionLogger" class="org.terasoluna.gfw.common.exception.ExceptionLogger" />

-------------------------------------------------------
003
使用環境
STS+TERASOLUNA+Spring-test(Junit)+H2+mybatis+maven+spring-test-dbunit

状況
@DatabaseSetupアノテーションで、xmlファイルからデータをセットアップする

エラー内容
Caused by: java.lang.NoClassDefFoundError: org/dbunit/dataset/xml/FlatXmlDataSetBuilder
	at com.github.springtestdbunit.dataset.FlatXmlDataSetLoader.createDataSet(FlatXmlDataSetLoader.java:36)
	at com.github.springtestdbunit.dataset.AbstractDataSetLoader.loadDataSet(AbstractDataSetLoader.java:54)
	at com.github.springtestdbunit.DbUnitRunner.loadDataset(DbUnitRunner.java:209)
	at com.github.springtestdbunit.DbUnitRunner.loadDataSets(DbUnitRunner.java:192)
	at com.github.springtestdbunit.DbUnitRunner.setupOrTeardown(DbUnitRunner.java:173)
	at com.github.springtestdbunit.DbUnitRunner.beforeTestMethod(DbUnitRunner.java:75)
	at com.github.springtestdbunit.DbUnitTestExecutionListener.beforeTestMethod(DbUnitTestExecutionListener.java:185)
	at com.github.springtestdbunit.TestExecutionListenerChain$3.call(TestExecutionListenerChain.java:94)
	at com.github.springtestdbunit.TestExecutionListenerChain.runChain(TestExecutionListenerChain.java:127)
	... 24 common frames omitted
	Caused by: java.lang.ClassNotFoundException: org.dbunit.dataset.xml.FlatXmlDataSetBuilder
	at java.net.URLClassLoader.findClass(Unknown Source)
	at java.lang.ClassLoader.loadClass(Unknown Source)
	at sun.misc.Launcher$AppClassLoader.loadClass(Unknown Source)
	at java.lang.ClassLoader.loadClass(Unknown Source)
	... 33 common frames omitted

原因
@DatabaseSetupはspring-test-dbunitが提供している
必要なライブラリが不足している。
dbunitが提供している、「FlatXmlDataSetBuilder.class」が存在していないため

解決策

自分の設定していた、pom.xmlのmavenプラグインを確認
<dependency>
    <groupId>org.dbunit</groupId>
    <artifactId>dbunit</artifactId>
    <version>2.4.3</version>
</dependency>

Maven依存関係から org.dbunit.dataset.xml.FlatXmlDataSetBuilder.classを確認
⇒存在しない

バージョンを新しくして設定
<dependency>
    <groupId>org.dbunit</groupId>
    <artifactId>dbunit</artifactId>
    <version>2.5.3</version>
</dependency>

Maven依存関係から org.dbunit.dataset.xml.FlatXmlDataSetBuilder.classを確認
⇒ある

正常に動作


-------------------------------------------------------



